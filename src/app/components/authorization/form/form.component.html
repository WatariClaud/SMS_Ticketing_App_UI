<app-notifier [message]="notificationMessage" [type]="notificationType"></app-notifier>
<form FormGroup="authForm">
  <div class="has-padding">
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{ FormTitle }}</mat-card-title>
      </mat-card-header>
      <br /><br />
      <mat-card-content>
        @if(isGuardAuth === 'false') {
          @for(input of FormInputs; track input.id) {
          <mat-form-field appearance="fill" class="input-box">
            <mat-label>{{ input.title }}</mat-label>
            @if(input.title) {
              @if(input.title === 'mobile_number') {
              <input matInput type="tel" name="mobile_number" #mobileNumber />
              }
            @if(input.title === 'service_needed') {
              <mat-select (selectionChange)="onServiceChange($event)">
                <mat-option value="" disabled>Select service</mat-option>
                @if(services_available.length === 0) {
                <mat-option value="update_later_1">No services available</mat-option>
                } @else {
                @for(service of services_available; track service.id) {
                <mat-option value="{{ service.id }}">{{ service.title }}</mat-option>
                }
                }
              </mat-select>
            }
            @if(input.title === 'referred_by') {
              <input matInput type="text" name="managed_by" #managed_by />
            }
            @if(input.title === 'managed_by') {
              <input matInput type="text" name="referred_by" #ref_by />
            }
            @if(input.title === 'email_address') {
            <input matInput type="email" name="email" #email_address />
            }
            @if(input.title === 'name') {
                <input matInput type="text" name="name" #name />
            }
            @if(input.title === 'password') {
            <input matInput type="password" name="password" #password />
            }
            @if(isAddingNewUser === true) {
              @if(input.title === 'role') {
                <mat-select name="user_role" (selectionChange)="onRoleChange($event)">
                  <mat-option value="" disabled>Select Role</mat-option>
                  @if(FormInputs.length === 0) {
                    <mat-option value="none">No roles available</mat-option>
                  } @else {
                    @for(role of roles; track role.id) {
                    <mat-option value="{{ role.id }}">{{ role.title }}</mat-option>
                  }
                }
                </mat-select>
              }
              @if(input.title === 'teller_counter_name' && selectedRoleId === '1') {
                <input matInput type="text" name="teller_counter_name" #teller_counter_name />
              }
              @if(input.title === 'teller_counter_name' && selectedRoleId !== '1') {
                <input matInput #hidden class="hidden"/>
              }
            }
            }
          </mat-form-field>
          }
        } @else if(isGuardAuth === 'true'){
          <br><br>
          <mat-label>Guard's Name</mat-label>
          <br><br>
          <mat-select name="security_guard_name" (selectionChange)="onGuardChange($event)" class="mat-select">
            <mat-option value="" disabled>Select Guard's name</mat-option>
            @if(FormInputs.length === 0) {
            <mat-option value="none">No guards available</mat-option>
            } @else {
            @for(guard of FormInputs; track guard.id) {
            <mat-option value="{{ guard.id }}">{{ guard.name }}</mat-option>
            }
            }
          </mat-select>
        }
        <div class="input-box">
          <app-current-time></app-current-time>
        </div>
      </mat-card-content>
      <div class="input-box">
        <div class="ml">
          <mat-card-actions>
            @if(isGuardAuth === 'false') {
            <div class="flex">
              <app-button [ButtonText]=" isLoadingRequest ? 'Sending Request...' : isAdminAuth === 'true' ? 'Sign In' 
              : isAddingNewUser ? 'Create Account' : isAuthenticatingUser ? 'Log In' 
              : isAddingNewStation ? 'Add Desk' : 'Create Ticket'"
                [ButtonEvent]="isAdminAuth === 'true' ? authenticateAdmin.bind(this) 
                : isAddingNewUser ? addUser.bind(this) : isAuthenticatingUser ? authUser.bind(this) 
                : isAddingNewStation ? createDesk.bind(this) : createTicket.bind(this)">
              </app-button>

              @if(isAddingNewUser) {
              <span class="spacing"></span><a href="/login-user">Already have an account?</a>
              }
            </div>
            }
            @else if(isGuardAuth === 'true') {
            <app-button ButtonText="Authenticate" [ButtonEvent]="startGuardSession.bind(this)"
              (hasValidInput)="has_valid_selected"></app-button>
            }
          </mat-card-actions>
        </div>
      </div>
    </mat-card>
  </div>
</form>